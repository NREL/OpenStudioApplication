#!/bin/sh
# Author: Julien Marrec

# Exit immediately if a command exits with a non-zero status
set -e

# Create symlinks
ls -sf @CPACK_PACKAGING_INSTALL_PREFIX@/bin/OpenStudioApp /usr/local/bin/OpenStudioApp
ls -sf @CPACK_PACKAGING_INSTALL_PREFIX@/bin/OpenStudioApp /usr/local/bin/OpenStudioApp-@OPENSTUDIOAPPLICATION_VERSION@

ls -sf @CPACK_PACKAGING_INSTALL_PREFIX@/bin/openstudio /usr/local/bin/openstudio
ls -sf @CPACK_PACKAGING_INSTALL_PREFIX@/bin/openstudio /usr/local/bin/openstudio-@OPENSTUDIO_VERSION@

cp @CPACK_PACKAGING_INSTALL_PREFIX@/Temp/openstudioapp.desktop /usr/share/applications
cp @CPACK_PACKAGING_INSTALL_PREFIX@/Temp/x-openstudio.xml /usr/share/mime/application

# Install icons
for i in {4..10}; do
  size=$((2**$i))
  # OS App is the only one that also has 512 and 1024
  if (( $size < 512)); then
    cp "@CPACK_PACKAGING_INSTALL_PREFIX@/Temp/osm_${size}.png" "/usr/share/icons/hicolor/${size}x${size}/mimetypes/application-x-openstudio.png"
    cp "@CPACK_PACKAGING_INSTALL_PREFIX@/Temp/osc_${size}.png" "/usr/share/icons/hicolor/${size}x${size}/mimetypes/application-x-openstudio-component.png"
  fi;

  cp "@CPACK_PACKAGING_INSTALL_PREFIX@/Temp/os_${size}.png" "/usr/share/icons/hicolor/${size}x${size}/mimetypes/openstudioapp.png"

done

# Delete the Temp directory
rm -Rf "@CPACK_PACKAGING_INSTALL_PREFIX@/Temp"

exit 0;
